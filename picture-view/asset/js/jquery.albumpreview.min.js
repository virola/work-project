/**
 * pic
 * @version 2014-11-28 17:4:45
 */
!function(e,i,a){i.fn.albumpreview=function(e){e=i.extend({},i.fn.albumpreview.defaults,e);var n=e.path+"/loading.gif",o=e.path+"/zoomin.cur",s=e.path+"/zoomout.cur",d=e.path+"/bigpicnext.cur",l=e.path+"/bigpicprev.cur";o="url('"+o+"'), pointer",s="url('"+s+"'), pointer",d="url('"+d+"'), pointer",l="url('"+l+"'), pointer";var u=['<div class="ui-preview-toolbar" style="display:none">','<span class="ui-preview-buttons" style="display:none">','<a href="#" data-go="hide" class="ui-preview-hide"><span></span>',e.hide,"</a>",'<a href="#" data-go="left" class="ui-preview-left"><span></span>',e.left,"</a>",'<a href="#" data-go="right" class="ui-preview-right"><span></span>',e.right,"</a>",e.source?'<a href="#" data-go="source" class="ui-preview-source"><span></span>':"",e.source,"</a>","</span>",'<span class="ui-preview-loading">','<img data-live="stop" src="',n,'" style="',"display:inline-block;*zoom:1;*display:inline;vertical-align:middle;",'width:16px;height:16px;"'," />","</span>","</div>",'<div class="ui-preview-box" style="display:none"></div>'].join(""),p=['<div class="ui-preview-photo">','<div class="ui-preview-photo-wrap">','<img data-name="thumb" data-go="hide" data-live="stop" src="',n,'">',"</div>",'<a class="ui-preview-photo-prev" href="#" data-go="prev" style="cursor:'+l+'"></a>','<a class="ui-preview-photo-next" href="#" data-go="next" style="cursor:'+d+'"></a>',"</div>"].join("");return i(this).each(function(){function n(e){if(!(e==f||0>e||e>g-1)){d();var i=l.find(".ui-preview-box").show(),a=i.find(".ui-preview-photo").addClass("ui-preview-hidden");a.eq(e).removeClass("ui-preview-hidden"),v=a.eq(e),f=e}}function d(){w||(l.show().find(".ui-preview-toolbar").slideDown(150,function(){l.get(0).scrollIntoView()}),h.hide(),w=1)}var l,h=i(this),c=e.imgClass?"."+e.imgClass:"img";h.bind("click",c,function(e){l=h.data("albumpreview"),l||x();var i=e.target;if("IMG"!==i.nodeName||"stop"===i.getAttribute("data-live"))return!1;var a=h.find(c).index(i);return n(a),!1});var v,f,w,g=h.find(c).length,m=e.maxWidth||"auto",b=e.maxHeight||99999;m-=2*e.borderWidth;var x=function(){l=i("<div>").addClass("ui-preview ui-preview-noLoad").append(u).hide(),e.appendTo?h.closest(e.appendTo).append(l):h.after(l);var a=function(e){var i=e.target,a=i.getAttribute("data-go"),r=i.getAttribute("data-live"),o=v.data("preview-degree")||0,s=v.find(".ui-preview-show")[0];if("stop"===r)return!1;switch(/img|canvas$/i.test(i.nodeName)&&(a="hide"),a){case"left":o-=90,o=-90===o?270:o;break;case"right":o+=90,o=360===o?0:o;break;case"source":window.open(source||show||src);break;case"hide":y();break;case"prev":n(f-1);break;case"next":n(f+1)}return"left"!==a&&"right"!==a||!v.data("preview-photo-load")||(t(s,o,m,b),v.data("preview-degree",o)),!1};M(),l.bind("click","[data-go]",a),h.data("albumpreview",l)},y=function(){h.show(),l.hide(),l.remove(),f=-1,v=null,h.data("albumpreview",null),h.get(0).scrollIntoView(),w=0},M=function(){var t=l.find(".ui-preview-box");h.find(c).each(function(){var n=this;if("IMG"!==n.nodeName)return!1;var o=i(n),d=i(p).addClass("ui-preview-hidden").appendTo(t),u=d.find("[data-name=thumb]"),h=o.attr(e.showAttr);e.showAttr&&h||(h=n.src),r(h,function(){var i=this.width,a=this.height,t=Math.min(m,i);a=t/i*a,i=t,u.attr("src",n.src).css(e.blur?{width:i+"px",height:a+"px"}:{display:"none"}),u.after(['<img class="ui-preview-show" data-go="hide" title="',n.title,'" alt="',n.alt,'" src="',h,'" style="width:',i,"px;cursor:",s,";height:",a,'px;position:absolute;left:0;top:0;background:transparent"'," />"].join("")),u.attr("class","ui-preview-show"),l.addClass("ui-preview-ready"),l.find(".ui-preview-buttons").show(),d.data("albumpreview-ready",!0)},function(){var e=l.find(".ui-preview-show");u.removeAttr("class").removeAttr("data-live").hide(),e.css({position:"static",left:"auto",top:"auto"}),l.removeClass("ui-preview-noLoad"),l.find(".ui-preview-loading").hide(),d.data("preview-photo-load",!0)},function(){l.addClass("ui-preview-error"),a('jQuery.fn.albumpreview: Load "'+h+'" Error!')})}),t.find(".ui-preview-photo-prev:first").hide(),t.find(".ui-preview-photo-next:last").hide()};h.find(c).css({cursor:o})}),this},i.fn.albumpreview.defaults={imgClass:"",showAttr:"",path:"./images",left:"左旋转",right:"右旋转",source:"看原图",hide:"×",blur:!0,preload:!0,maxWidth:null,maxHeight:null,borderWidth:18,appendTo:""};var t=i.imgRotate=function(){var a=/msie (\d+\.\d+)/i.test(navigator.userAgent)?e.documentMode||+RegExp.$1:void 0;return function(e,t,r,n){var o=e.naturalWidth,s=e.naturalHeight;if(!("naturalWidth"in e)){var d=e.runtimeStyle,l=d.width,u=d.height;d.width=d.height="auto",e.naturalWidth=o=e.width,e.naturalHeight=s=e.height,d.width=l,d.height=u}var p,h=1,c=0,v=function(e){e?(o=[s,s=o][0],o>n&&(h=n/o,s=h*s,o=n),s>r&&(h=h*r/s,o=r/s*o,s=r),c=-(o-s)/2):(o>r&&(h=r/o,s=h*s,o=r),s>n&&(h=h*n/s,o=n/s*o,s=n))};switch(t){case 0:case 180:v();break;case 90:case 270:v(!0),p=1}if(a&&9>a){var f=t>180?t-360:-180>t?360+t:t,w=f*(2*Math.PI/360);console.log(f),console.log(w);var g=["progid:DXImagetransform.Microsoft.Matrix(","M11="+Math.cos(w)+",M12=-"+Math.sin(w)+",","M21="+Math.sin(w)+",M22="+Math.cos(w)+",","SizingMethod='auto expand'",")"].join("");g="progid:DXImageTransform.Microsoft.BasicImage(rotation="+t/90+")",0==w&&(g=""),i(e).css("filter",g)}else{var m="translate(0, "+c+"px) rotate("+t+"deg) scale(1,1)";i(e).css({transform:m})}i(e).parent().height(p?s:"auto")}}(),r=function(){var e=[],i=null,a=function(){for(var i=0;i<e.length;i++)e[i].end?e.splice(i--,1):e[i]();!e.length&&t()},t=function(){clearInterval(i),i=null};return function(t,r,n,o){var s,d,l,u,p,h=new Image;return h.src=t,h.complete?(r.call(h),void(n&&n.call(h))):(d=h.width,l=h.height,h.onerror=function(){o&&o.call(h),s.end=!0,h=h.onload=h.onerror=null},s=function(){u=h.width,p=h.height,(u!==d||p!==l||u*p>1024)&&(r.call(h),s.end=!0)},s(),h.onload=function(){!s.end&&s(),n&&n.call(h),h=h.onload=h.onerror=null},void(s.end||(e.push(s),null===i&&(i=setInterval(a,40)))))}}()}(document,jQuery,function(e){window.console&&console.log(e)});