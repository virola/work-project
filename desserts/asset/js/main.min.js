/**
 * desserts
 * @version 2014-12-9 15:49:57
 */
define(["jquery"],function(e){"use strict";function n(){var t=new Date,i=t-v;h>=r||i>1e4?(l.removeClass("hide"),e(".loading").fadeOut(function(){e(this).remove()}),y.init(),w.start(),b.init()):setTimeout(function(){n()},500)}function t(){require(["swiper","swiper-smooth-progress"],function(e){c.noSwiping=1,c.noSwipingClass="swipe-stop",g=new e(".page-container",c),g.addCallback("SlideChangeEnd",o),a(),i()})}function i(){e(".s-page-foods").each(function(){var n=e(this).find("article").height(),t=e(window).height();if(n>t){var i=e(this).find(".pic-album"),a=i.outerHeight(),s=(t-e(this).find(".title").outerHeight())/i.outerHeight(),o=a*(s-1)*s;i.css("transform","scale("+s+", "+s+") translateY("+o+"px)")}})}function a(){e(".tab-nav li").on("touchstart",function(){{var n=e(this),t=n.closest(".tab");t.find(".tab-nav>li").index(n)}return n.hasClass("current")||(t.find(".tab-nav>li").removeClass("current"),n.addClass("current"),s(t)),!1}),e(".tab-content-item").on("webkitAnimationEnd",function(){e(this).css({opacity:1})}),s(e(".tab"))}function s(e){var n=e.find(".tab-nav li.current"),t=e.find(".tab-nav>li").index(n),i=e.find(".tab-content-item").css({opacity:0});i.removeClass(m).eq(t).addClass(m)}function o(n){var t=e(n.activeSlide());t.find(".video").size()>0&&C.init(),t.find(".video").each(function(){C.load(e(this).data("video-id"))})}var r,c,d={},l=e("#g-ctrl"),u=(e("#slide-main"),"slide-wrapper"),f="slide",p={scaleIn:{effects:{onProgressChange:function(e){for(var n=0;n<e.slides.length;n++){var t,i,a,s=e.slides[n],o=s.progress;0>=o?(a=1-Math.min(Math.abs(o),1),t=1-Math.min(Math.abs(o/2),1),i=o*e.width):(a=1-Math.min(Math.abs(o/2),1),t=1,i=0),s.style.opacity=a,e.setTransform(s,"translate3d(0,"+i+"px,0) scale("+t+")")}},onTouchStart:function(e){for(var n=0;n<e.slides.length;n++)e.setTransition(e.slides[n],0)},onSetWrapperTransition:function(e,n){for(var t=0;t<e.slides.length;t++)e.setTransition(e.slides[t],n)}}},scaleOut:{effects:{onProgressChange:function(e){for(var n=(e.activeIndex,0);n<e.slides.length;n++){var t,i,a,s=e.slides[n],o=s.progress;o>=0?(t=1-Math.min(Math.abs(o/2),1),i=o*e.width):(t=1,i=0),s.style.opacity=a,e.setTransform(s,"translate3d(0,"+i+"px,0) scale("+t+")")}},onTouchStart:function(e){for(var n=0;n<e.slides.length;n++)e.setTransition(e.slides[n],0)},onSetWrapperTransition:function(e,n){for(var t=0;t<e.slides.length;t++)e.setTransition(e.slides[t],n)}}}},h=0;d.init=function(i){var a=i.effect||"scaleOut";c=e.extend({wrapperClass:u,slideClass:f,slideElement:"section",mode:"vertical",preventLinks:!1},i,p[a].effects),c.updateOnImagesReady=1,c.onImagesReady=function(){n()};var s=[],o={};e(".slide").each(function(){e(this).width(e(window).width()).height(e(window).height());var n=e(this).css("background-image");if("none"!=n&&!o[n]){o[n]=1,n=n.replace(/\'|\"/,"").replace("url(","").replace(")",""),s.push(n);var t=new Image;t.src=n,t.onload=function(){this.complete&&h++}}}),r=s.length,v=new Date,t()};var v,g,y=function(){function n(){t.on("click",function(){t.hasClass("player-btn-stop")?y.on():y.off()}),i[0].play()}var t=e(".player-btn"),i=e(".bg-music");return{init:n,off:function(){t.addClass("player-btn-stop"),i[0].pause()},on:function(){t.removeClass("player-btn-stop"),i[0].play()}}}(),m="left-in",w=function(){function n(){e(t).fadeOut()}var t=".s-homepage";return{init:function(){require(["jquery-eraser"],function(e){e(t).eraser({size:e(window).width()/10,completeRatio:.3,progressFunction:function(){},completeFunction:n});e(".s-homepage")})},start:n}}(),b=function(){function n(){e(".video").on("click",function(){var n=e(this).data("video-id");C.play(n)})}return{init:n}}(),C=function(){function n(n){if(c[n])return c[n].id;var t=e("<div/>").addClass("video-player").attr("id","videoframe-"+n),i=(e("<span>x</span>").addClass("video-player-close").on("click",function(){a(n)}).appendTo(t),e("<div/>").addClass("video-wrap").attr("id","videosrc-"+n).appendTo(t));return i.css({width:l+"px",height:.8*d+"px",top:.1*d+"px"}),t.appendTo(e(document.body)),c[n]={id:i[0].id,container:t[0]},c[n].id}function t(e){if(!s)return setTimeout(function(){t(e)},500),!1;var i=c[e]&&c[e].player;i||(i=new YKU.Player(n(e),{styleid:"4",client_id:"--",vid:e,autoplay:!1,events:{onPlayEnd:function(){c[e].container.style.zIndex=-1}}}),c[e].player=i)}function i(n){if(!c[n])return!1;var t=c[n].container,i=e(t).find(".x-video-player")[0];if(i&&i.src)i.play(),i.webkitRequestFullScreen(),y.off();else if(c[n].player)y.off(),e(t).css("zIndex",9999),c[n].player.playVideo();else{var a=e("<span/>").addClass("err-msg").text("用户过多，请稍后再试!").appendTo(e(document.body));a.css({marginLeft:-a.outerWidth()/2+"px"}).delay(3e3).fadeOut(function(){e(this).remove()})}}function a(n){if(!c[n])return!1;var t=c[n].container;c[n]&&c[n].player&&(e(t).css("zIndex",-1),c[n].player.pauseVideo())}var s,o,r="http://player.youku.com/jsapi",c={},d=e(window).height(),l=e(window).width();return{play:i,load:t,stop:a,init:function(){return o?!1:(o=1,void e.ajax({url:r,dataType:"script",cache:!0,success:function(){s=1}}))}}}();return d});