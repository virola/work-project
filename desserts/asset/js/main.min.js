/**
 * desserts
 * @version 2014-12-16 14:40:1
 */
define(["jquery"],function(n){"use strict";function e(){var t=new Date,i=t-v;h>=r||i>1e4?(l.removeClass("hide"),n(".loading").fadeOut(function(){n(this).remove()}),y.init(),b.init(),C.init()):setTimeout(function(){e()},500)}function t(){require(["swiper","swiper-smooth-progress"],function(n){c.noSwiping=1,c.noSwipingClass="swipe-stop",g=new n(".page-container",c),g.addCallback("SlideChangeEnd",o),a(),i(),m.init(),m.start(0)})}function i(){n(".s-page-foods").each(function(){var e=n(this).find("article").height(),t=n(window).height();if(e>t){var i=n(this).find(".pic-album"),a=i.outerHeight(),s=(t-n(this).find(".title").outerHeight())/i.outerHeight(),o=a*(s-1)*s;i.css("transform","scale("+s+", "+s+") translateY("+o+"px)")}})}function a(){n(".tab-nav li").on("touchstart",function(){{var e=n(this),t=e.closest(".tab");t.find(".tab-nav>li").index(e)}return e.hasClass("current")||(t.find(".tab-nav>li").removeClass("current"),e.addClass("current"),s(t)),!1}),n(".tab-content-item").on("webkitAnimationEnd",function(){n(this).css({opacity:1})}),s(n(".tab"))}function s(n){var e=n.find(".tab-nav li.current"),t=n.find(".tab-nav>li").index(e),i=n.find(".tab-content-item").css({opacity:0});i.removeClass(w).eq(t).addClass(w)}function o(e){var t=n(e.activeSlide());t.find(".video").size()>0&&x.init(),t.find(".video").each(function(){x.load(n(this).data("video-id"))}),m.start(e.activeIndex)}var r,c,d={},l=n("#g-ctrl"),u=(n("#slide-main"),"slide-wrapper"),f="slide",p={scaleIn:{effects:{onProgressChange:function(n){for(var e=0;e<n.slides.length;e++){var t,i,a,s=n.slides[e],o=s.progress;0>=o?(a=1-Math.min(Math.abs(o),1),t=1-Math.min(Math.abs(o/2),1),i=o*n.width):(a=1-Math.min(Math.abs(o/2),1),t=1,i=0),s.style.opacity=a,n.setTransform(s,"translate3d(0,"+i+"px,0) scale("+t+")")}},onTouchStart:function(n){for(var e=0;e<n.slides.length;e++)n.setTransition(n.slides[e],0)},onSetWrapperTransition:function(n,e){for(var t=0;t<n.slides.length;t++)n.setTransition(n.slides[t],e)}}},scaleOut:{effects:{onProgressChange:function(n){for(var e=(n.activeIndex,0);e<n.slides.length;e++){var t,i,a,s=n.slides[e],o=s.progress;o>=0?(a=1-Math.min(Math.abs(o),1),t=1-Math.min(Math.abs(o/2),1),i=o*n.width):(a=1-Math.min(Math.abs(o/2),1),t=1,i=0),s.style.opacity=a,n.setTransform(s,"translate3d(0,"+i+"px,0) scale("+t+")")}},onTouchStart:function(n){for(var e=0;e<n.slides.length;e++)n.setTransition(n.slides[e],0)},onSetWrapperTransition:function(n,e){for(var t=0;t<n.slides.length;t++)n.setTransition(n.slides[t],e)}}}},h=0;d.init=function(i){var a=i.effect||"scaleOut";c=n.extend({wrapperClass:u,slideClass:f,slideElement:"section",mode:"vertical",preventLinks:!1},i,p[a].effects),c.updateOnImagesReady=1,c.onImagesReady=function(){e()};var s=[],o={};n(".slide").each(function(){n(this).width(n(window).width()).height(n(window).height());var e=n(this).css("background-image");if("none"!=e&&!o[e]){o[e]=1,e=e.replace(/\'|\"/,"").replace("url(","").replace(")",""),s.push(e);var t=new Image;t.src=e,t.onload=function(){this.complete&&h++}}}),r=s.length,v=new Date,t()};var v,g,m=function(){function e(e){null!=e&&t.eq(e).children().each(function(e){n(this).delay(400*e).fadeIn(800)})}var t=n("article");return{init:function(){t.children().hide()},start:e}}(),y=function(){function e(){t.on("click",function(){t.hasClass("player-btn-stop")?y.on():y.off()}),i[0].play()}var t=n(".player-btn"),i=n(".bg-music");return{init:e,off:function(){t.addClass("player-btn-stop"),i[0].pause()},on:function(){t.removeClass("player-btn-stop"),i[0].play()}}}(),w="left-in",b=function(){function e(){n(i).fadeOut()}var t=.3,i=".s-homepage";return{init:function(){require(["jquery-eraser"],function(n){n(i).eraser({size:n(window).width()/10,completeRatio:t,progressFunction:function(){},completeFunction:e});n(".s-homepage")})},start:e}}(),C=function(){function e(){n(".video").on("click",function(){var e=n(this).data("video-id");x.play(e)})}return{init:e}}(),x=function(){function e(e){if(c[e])return c[e].id;var t=n("<div/>").addClass("video-player").attr("id","videoframe-"+e),i=(n("<span>x</span>").addClass("video-player-close").on("click",function(){a(e)}).appendTo(t),n("<div/>").addClass("video-wrap").attr("id","videosrc-"+e).appendTo(t));return i.css({width:l+"px",height:.8*d+"px",top:.1*d+"px"}),t.appendTo(n(document.body)),c[e]={id:i[0].id,container:t[0]},c[e].id}function t(n){if(!s)return setTimeout(function(){t(n)},500),!1;var i=c[n]&&c[n].player;i||(i=new YKU.Player(e(n),{styleid:"4",client_id:"--",vid:n,autoplay:!1,events:{onPlayEnd:function(){c[n].container.style.zIndex=-1}}}),c[n].player=i)}function i(e){if(!c[e])return!1;var t=c[e].container,i=n(t).find(".x-video-player")[0];if(i&&i.src)i.play(),i.webkitRequestFullScreen(),y.off();else if(c[e].player)y.off(),n(t).css("zIndex",9999),c[e].player.playVideo();else{var a=n("<span/>").addClass("err-msg").text("用户过多，请稍后再试!").appendTo(n(document.body));a.css({marginLeft:-a.outerWidth()/2+"px"}).delay(3e3).fadeOut(function(){n(this).remove()})}}function a(e){if(!c[e])return!1;var t=c[e].container;c[e]&&c[e].player&&(n(t).css("zIndex",-1),c[e].player.pauseVideo())}var s,o,r="http://player.youku.com/jsapi",c={},d=n(window).height(),l=n(window).width();return{play:i,load:t,stop:a,init:function(){return o?!1:(o=1,void n.ajax({url:r,dataType:"script",cache:!0,success:function(){s=1}}))}}}();return d});