/**
 * desserts
 * @version 2014-12-19 10:52:45
 */
define(["jquery"],function(e){"use strict";function t(){var n=new Date,i=n-g;v>=r||i>1e4?(f.removeClass("hide"),e(".loading").fadeOut(function(){e(this).remove()}),w.init(),C.init(),T.init()):setTimeout(function(){t()},500)}function n(){require(["swiper","swiper-smooth-progress"],function(e){c.noSwiping=1,c.noSwipingClass="swipe-stop",m=new e(".page-container",c),m.addCallback("SlideChangeEnd",o),a(),i(),y.init(),y.start(0)})}function i(){e(".s-page-foods").each(function(){var t=e(this).find("article").height(),n=e(window).height();if(t>n){var i=e(this).find(".pic-album"),a=i.height(),s=(n-e(this).find(".title").outerHeight())/a,o=a*(s-1)*s;i.css("transform","scale("+s+", "+s+") translateY("+o+"px)")}var r=e(this),c=r.find(".foods-list").children(),d=c.outerHeight()*c.size()-15,l=0;r.find(".foods-list").on("scroll",function(){var t=e(this),n=t.scrollTop();n>l?n>=d&&t.removeClass("swipe-stop"):0==n&&t.removeClass("swipe-stop"),l=n})})}function a(){e(".tab-nav li").on("touchstart",function(){var t=e(this),n=t.closest(".tab");return t.hasClass("current")||(n.find(".tab-nav>li").removeClass("current"),t.addClass("current"),s(n)),!1}),e(".tab-content-item").on("webkitAnimationEnd",function(){e(this).css({opacity:1})}),s(e(".tab"))}function s(e){var t=e.find(".tab-nav li.current"),n=t.data("target"),i=e.find(".tab-content-item").css({opacity:0}).removeClass(b),a=i.filter('[data-target="'+n+'"]');a.addClass(b)}function o(t){var n=e(t.activeSlide());n.find(".video").size()>0&&x.init(),n.find(".video").each(function(){x.load(e(this).data("video-id"))}),n.find(".foods-list").addClass("swipe-stop"),y.start(t.activeIndex)}var r,c,d,l={},f=e("#g-ctrl"),u=(e("#slide-main"),"slide-wrapper"),p="slide",h={scaleIn:{effects:{onProgressChange:function(e){for(var t=0;t<e.slides.length;t++){var n,i,a,s=e.slides[t],o=s.progress;0>=o?(a=1-Math.min(Math.abs(o),1),n=1-Math.min(Math.abs(o/2),1),i=o*e.width):(a=1-Math.min(Math.abs(o/2),1),n=1,i=0),s.style.opacity=a,e.setTransform(s,"translate3d(0,"+i+"px,0) scale("+n+")")}},onTouchStart:function(e){for(var t=0;t<e.slides.length;t++)e.setTransition(e.slides[t],0)},onSetWrapperTransition:function(e,t){for(var n=0;n<e.slides.length;n++)e.setTransition(e.slides[n],t)}}},scaleOut:{effects:{onProgressChange:function(e){for(var t=(e.activeIndex,0);t<e.slides.length;t++){var n,i,a,s=e.slides[t],o=s.progress;o>=0?(a=1-Math.min(Math.abs(o),1),n=1-Math.min(Math.abs(o/2),1),i=o*e.width):(a=1-Math.min(Math.abs(o/2),1),n=1,i=0),s.style.opacity=a,e.setTransform(s,"translate3d(0,"+i+"px,0) scale("+n+")")}},onTouchStart:function(e){for(var t=0;t<e.slides.length;t++)e.setTransition(e.slides[t],0)},onSetWrapperTransition:function(e,t){for(var n=0;n<e.slides.length;n++)e.setTransition(e.slides[n],t)}}}},v=0;l.init=function(i,a){var s=i.effect||"scaleOut";c=e.extend({wrapperClass:u,slideClass:p,slideElement:"section",mode:"vertical",preventLinks:!1},i,h[s].effects),d=a||"",c.updateOnImagesReady=1,c.onImagesReady=function(){t()};var o=[],l={};e(".slide").each(function(){e(this).width(e(window).width()).height(e(window).height());var t=e(this).css("background-image");if("none"!=t&&!l[t]){l[t]=1,t=t.replace(/\'|\"/,"").replace("url(","").replace(")",""),o.push(t);var n=new Image;n.src=t,n.onload=function(){this.complete&&v++}}}),r=o.length,g=new Date,n()};var g,m,y=function(){function t(t){null!=t&&n.eq(t).children().each(function(t){e(this).delay(400*t).fadeIn(800)})}var n=e("article");return{init:function(){n.children().hide()},start:t}}(),w=function(){function t(){n.on("click",function(){n.hasClass("player-btn-stop")?w.on():w.off()}),i[0].play()}var n=e(".player-btn"),i=e(".bg-music");return{init:t,off:function(){n.addClass("player-btn-stop"),i[0].pause()},on:function(){n.removeClass("player-btn-stop"),i[0].play()}}}(),b="left-in",C=function(){function t(){e(i).fadeOut()}var n=.3,i=".s-homepage";return{init:function(){require(["jquery-eraser"],function(e){e(i).eraser({size:e(window).width()/10,completeRatio:n,progressFunction:function(){},completeFunction:t});e(".s-homepage")})},start:t}}(),T=function(){function t(){e(".video").on("click",function(){var t=e(this).data("video-id");x.play(t)})}return{init:t}}(),x=function(){function t(t){if(c[t])return c[t].id;var n=e("<div/>").addClass("video-player").attr("id","videoframe-"+t),i=(e("<span>x</span>").addClass("video-player-close").on("click",function(){a(t)}).appendTo(n),e("<div/>").addClass("video-wrap").attr("id","videosrc-"+t).appendTo(n));return n.appendTo(e(document.body)),i.css({width:f+"px",height:.8*l+"px",top:.1*l+"px"}),c[t]={id:i[0].id,container:n[0]},c[t].id}function n(e){if(!s)return setTimeout(function(){n(e)},500),!1;var i=c[e]&&c[e].player;i||(i=new YKU.Player(t(e),{styleid:"4",client_id:d,vid:e,autoplay:!1,events:{onPlayEnd:function(){c[e].container.style.zIndex=-1}}}),c[e].player=i)}function i(t){if(!c[t])return!1;var n=c[t].container,i=e(n).find(".x-video-player")[0];if(i&&i.src)i.play(),i.webkitRequestFullScreen(),w.off();else if(c[t].player)w.off(),e(n).css("zIndex",9999),c[t].player.playVideo();else{var a=e("<span/>").addClass("err-msg").text("用户过多，请稍后再试!").appendTo(e(document.body));a.css({marginLeft:-a.outerWidth()/2+"px"}).delay(3e3).fadeOut(function(){e(this).remove()})}}function a(t){if(!c[t])return!1;var n=c[t].container;c[t]&&c[t].player&&(e(n).css("zIndex",-1),c[t].player.pauseVideo())}var s,o,r="http://player.youku.com/jsapi",c={},l=e(".page-container").height(),f=e(".page-container").width();return{play:i,load:n,stop:a,init:function(){return o?!1:(o=1,void e.ajax({url:r,dataType:"script",cache:!0,success:function(){s=1}}))}}}();return l});