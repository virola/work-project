/**
 * desserts
 * @version 2014-12-22 16:15:1
 */
define(["jquery"],function(t){"use strict";function n(){var i=new Date,e=i-w;m>=c&&e>2e3&&k.isLoaded()?(h.removeClass("hide"),t(".loading").fadeOut(function(){t(this).remove()}),T.init(),S.init()):setTimeout(function(){n()},200)}function i(){require(["swiper","swiper-smooth-progress"],function(t){d.noSwiping=1,d.noSwipingClass="swipe-stop",y=new t(".page-container",d),y.addCallback("SlideChangeStart",r),y.addCallback("SlideChangeEnd",s),a(),e(),C.init(),C.start(0)})}function e(){t(".s-page-foods").each(function(){var n=t(this).find("article").height(),i=t(window).height();if(n>i){var e=t(this).find(".pic-album"),a=e.height(),o=(i-t(this).find(".title").outerHeight())/a,r=a*(o-1)*o;e.css("transform","scale("+o+", "+o+") translateY("+r+"px)")}var s=t(this),c=s.find(".foods-list").children(),d=c.outerHeight()*c.size()-15,u=0;s.find(".foods-list").on("scroll",function(){var n=t(this),i=n.scrollTop();i>u?i>=d&&n.removeClass("swipe-stop"):0==i&&n.removeClass("swipe-stop"),u=i})})}function a(){t(".tab-nav li").on("touchstart",function(){var n=t(this),i=n.closest(".tab");return n.hasClass("current")||(i.find(".tab-nav>li").removeClass("current"),n.addClass("current"),o(i)),!1}),t(".tab-content-item").on("webkitAnimationEnd",function(){t(this).css({opacity:1})}),o(t(".tab"))}function o(t){var n=t.find(".tab-nav li.current"),i=n.data("target"),e=t.find(".tab-content-item").css({opacity:0}).removeClass(x),a=e.filter('[data-target="'+i+'"]');a.addClass(x)}function r(){}function s(n){var i=t(n.activeSlide());i.find(".foods-list").addClass("swipe-stop"),C.init(),C.start(n.activeIndex)}var c,d,u,f,l={},h=t("#g-ctrl"),p=(t("#slide-main"),"slide-wrapper"),v="slide",g={scaleOut:{effects:{onProgressChange:function(t){for(var n=(t.activeIndex,0);n<t.slides.length;n++){var i,e,a,o=t.slides[n],r=o.progress;r>0?(a=1-Math.min(Math.abs(r),1),i=1-Math.min(Math.abs(r/2),1),e=r*t.width):(a=1,i=1,e=0),o.style.opacity=a,t.setTransform(o,"translate3d(0,"+e+"px,0) scale("+i+")")}},onTouchStart:function(t){for(var n=0;n<t.slides.length;n++)t.setTransition(t.slides[n],0)},onSetWrapperTransition:function(t,n){for(var i=0;i<t.slides.length;i++)t.setTransition(t.slides[i],n)}}}},m=0;l.init=function(e,a,o){var r=e.effect||"scaleOut";d=t.extend({wrapperClass:p,slideClass:v,slideElement:"section",mode:"vertical",preventLinks:!1},e,g[r].effects),u=a||"",f=o||"",d.updateOnImagesReady=1,d.onImagesReady=function(){n(),k.init()};var s=[],l={};t(".slide").each(function(){t(this).width(t(window).width()).height(t(window).height());var n=t(this).css("background-image");if("none"!=n&&!l[n]){l[n]=1,n=n.replace(/\'|\"/,"").replace("url(","").replace(")",""),s.push(n);var i=new Image;i.src=n,i.onload=function(){this.complete&&m++}}}),c=s.length,w=new Date,i()};var w,y,C=function(){function n(n){null!=n&&i.eq(n).children().each(function(n){t(this).delay(200*n).fadeIn(400)})}var i=t("article");return{init:function(){i.children().hide()},start:n}}(),b=function(){function n(){i.on("click",function(){i.hasClass("player-btn-stop")?b.on():b.off()})}var i=t(".player-btn"),e=t(".bg-music");return{init:n,off:function(){i.addClass("player-btn-stop"),e[0].pause()},on:function(){i.removeClass("player-btn-stop"),e[0].play()}}}(),x="left-in",T=function(){function n(){return i?!1:(i=1,e.fadeOut(1500,function(){e.remove()}),void b.init())}var i,e=t(".home-mask"),a={},o=5;return{init:function(){var i=t(window).width();e.width(i).height(t(window).height()),e.find("img[data-animation]").each(function(){t(this).addClass(t(this).data("animation"))}),e.on("touchstart","img[data-animation]",function(t){var n=t.originalEvent.changedTouches[0];a.x=n.pageX,a.y=n.pageY});var r=e.find("img");e.on("touchmove","img[data-animation]",function(t){t.preventDefault();var e,s=t.originalEvent.changedTouches[0];if(s.pageX<a.x-o?e="left":s.pageX>a.x+o&&(e="right"),e){var c=s.pageY-a.y;c=5*c,"left"==e&&r.animate({left:-i+"px",top:c+"px"},1500),"right"==e&&r.animate({left:1.5*i+"px",top:c+"px"},1500),setTimeout(function(){n()},500)}}),e.on("touchmove",function(){return!1}),t(document).one("touchstart",function(){b.on()})},start:n}}(),S=function(){function n(){t(".video").each(function(){var n=t(this);n.width(n.width()).height(n.height())}),t(".video").on("click",function(){var n=t(this).data("video-id");k.load(n,t(this))})}return{init:n}}(),k=function(){function n(n,i){var e="videoframe-"+n;return o[n]?o[n].id:(t(i).attr("id",e),o[n]={id:e,container:t(i)[0]},o[n].id)}function i(t,e){if(!a)return setTimeout(function(){i(t)},500),!1;var r=o[t]&&o[t].player;r||(r=new YKU.Player(n(t,e),{styleid:"4",client_id:u,vid:t,autoplay:!0,events:{onPlayStart:function(){b.off()}}}),o[t].player=r)}function e(n){if(!o[n])return!1;var i=o[n].container;o[n]&&o[n].player&&(t(i).css("zIndex",-1),o[n].player.pauseVideo())}{var a,o={};t(".page-container").height(),t(".page-container").width()}return{load:i,stop:e,init:function(){if(a)return!1;var n=f;t.ajax({url:n,dataType:"script",timeout:15e3,cache:!0,success:function(){a=1},error:function(){k.init()}})},isLoaded:function(){return a}}}();return l});