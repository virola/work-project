/**
 * desserts
 * @version 2014-12-19 21:53:55
 */
define(["jquery"],function(t){"use strict";function n(){var i=new Date,e=i-m;g>=r&&e>2e3&&M.isLoaded()?(u.removeClass("hide"),t(".loading").fadeOut(function(){t(this).remove()}),x.init(),T.init()):setTimeout(function(){n()},500)}function i(){require(["swiper","swiper-smooth-progress"],function(t){c.noSwiping=1,c.noSwipingClass="swipe-stop",w=new t(".page-container",c),w.addCallback("SlideChangeEnd",o),a(),e(),y.init(),y.start(0)})}function e(){t(".s-page-foods").each(function(){var n=t(this).find("article").height(),i=t(window).height();if(n>i){var e=t(this).find(".pic-album"),a=e.height(),s=(i-t(this).find(".title").outerHeight())/a,o=a*(s-1)*s;e.css("transform","scale("+s+", "+s+") translateY("+o+"px)")}var r=t(this),c=r.find(".foods-list").children(),l=c.outerHeight()*c.size()-15,d=0;r.find(".foods-list").on("scroll",function(){var n=t(this),i=n.scrollTop();i>d?i>=l&&n.removeClass("swipe-stop"):0==i&&n.removeClass("swipe-stop"),d=i})})}function a(){t(".tab-nav li").on("touchstart",function(){var n=t(this),i=n.closest(".tab");return n.hasClass("current")||(i.find(".tab-nav>li").removeClass("current"),n.addClass("current"),s(i)),!1}),t(".tab-content-item").on("webkitAnimationEnd",function(){t(this).css({opacity:1})}),s(t(".tab"))}function s(t){var n=t.find(".tab-nav li.current"),i=n.data("target"),e=t.find(".tab-content-item").css({opacity:0}).removeClass(C),a=e.filter('[data-target="'+i+'"]');a.addClass(C)}function o(n){var i=t(n.activeSlide());i.find(".foods-list").addClass("swipe-stop"),y.start(n.activeIndex)}var r,c,l,d,f={},u=t("#g-ctrl"),h=(t("#slide-main"),"slide-wrapper"),p="slide",v={scaleIn:{effects:{onProgressChange:function(t){for(var n=0;n<t.slides.length;n++){var i,e,a,s=t.slides[n],o=s.progress;0>=o?(a=1-Math.min(Math.abs(o),1),i=1-Math.min(Math.abs(o/2),1),e=o*t.width):(a=1-Math.min(Math.abs(o/2),1),i=1,e=0),s.style.opacity=a,t.setTransform(s,"translate3d(0,"+e+"px,0) scale("+i+")")}},onTouchStart:function(t){for(var n=0;n<t.slides.length;n++)t.setTransition(t.slides[n],0)},onSetWrapperTransition:function(t,n){for(var i=0;i<t.slides.length;i++)t.setTransition(t.slides[i],n)}}},scaleOut:{effects:{onProgressChange:function(t){for(var n=(t.activeIndex,0);n<t.slides.length;n++){var i,e,a,s=t.slides[n],o=s.progress;o>=0?(a=1-Math.min(Math.abs(o),1),i=1-Math.min(Math.abs(o/2),1),e=o*t.width):(a=1-Math.min(Math.abs(o/2),1),i=1,e=0),s.style.opacity=a,t.setTransform(s,"translate3d(0,"+e+"px,0) scale("+i+")")}},onTouchStart:function(t){for(var n=0;n<t.slides.length;n++)t.setTransition(t.slides[n],0)},onSetWrapperTransition:function(t,n){for(var i=0;i<t.slides.length;i++)t.setTransition(t.slides[i],n)}}}},g=0;f.init=function(e,a,s){var o=e.effect||"scaleOut";c=t.extend({wrapperClass:h,slideClass:p,slideElement:"section",mode:"vertical",preventLinks:!1},e,v[o].effects),l=a||"",d=s||"",c.updateOnImagesReady=1,c.onImagesReady=function(){n(),M.init()};var f=[],u={};t(".slide").each(function(){t(this).width(t(window).width()).height(t(window).height());var n=t(this).css("background-image");if("none"!=n&&!u[n]){u[n]=1,n=n.replace(/\'|\"/,"").replace("url(","").replace(")",""),f.push(n);var i=new Image;i.src=n,i.onload=function(){this.complete&&g++}}}),r=f.length,m=new Date,i()};var m,w,y=function(){function n(n){null!=n&&i.eq(n).children().each(function(n){t(this).delay(400*n).fadeIn(800)})}var i=t("article");return{init:function(){i.children().hide()},start:n}}(),b=function(){function n(){i.on("click",function(){i.hasClass("player-btn-stop")?b.on():b.off()}),e.attr("autoplay",!0),b.on()}var i=t(".player-btn"),e=t(".bg-music");return{init:n,off:function(){i.addClass("player-btn-stop"),e[0].pause()},on:function(){i.removeClass("player-btn-stop"),e[0].play()}}}(),C="left-in",x=function(){function n(){t(".homepage").fadeOut(1500),b.init()}var i=t(".home-mask"),e={},a=10;return{init:function(){var s=t(window).width(),o=i.find("img");i.find("img[data-animation]").each(function(){t(this).addClass(t(this).data("animation"))}),i.on("touchstart","img[data-animation]",function(t){var n=t.originalEvent.changedTouches[0];e.x=n.pageX,e.y=n.pageY}),i.on("touchmove","img[data-animation]",function(t){t.preventDefault();var i,r=t.originalEvent.changedTouches[0];if(console.log(r.pageX,e.x),r.pageX<e.x-a?i="left":r.pageX>e.x+a&&(i="right"),i){o.addClass("jumpout");var c=r.pageY-e.y;c=10*c,"left"==i&&o.css({left:-s+"px",top:c+"px"}),"right"==i&&o.css({left:1.5*s+"px",top:c+"px"}),n()}})},start:n}}(),T=function(){function n(){t(".video").each(function(){var n=t(this);n.width(n.width()).height(n.height())}),t(".video").on("click",function(){var n=t(this).data("video-id");M.load(n,t(this))})}return{init:n}}(),M=function(){function n(n,i){var e="videoframe-"+n;return s[n]?s[n].id:(t(i).attr("id",e),s[n]={id:e,container:t(i)[0]},s[n].id)}function i(t,e){if(!a)return setTimeout(function(){i(t)},500),!1;var o=s[t]&&s[t].player;o||(o=new YKU.Player(n(t,e),{styleid:"4",client_id:l,vid:t,autoplay:!0,events:{onPlayStart:function(){b.off()}}}),s[t].player=o)}function e(n){if(!s[n])return!1;var i=s[n].container;s[n]&&s[n].player&&(t(i).css("zIndex",-1),s[n].player.pauseVideo())}{var a,s={};t(".page-container").height(),t(".page-container").width()}return{load:i,stop:e,init:function(){if(a)return!1;var n=d;t.ajax({url:n,dataType:"script",timeout:15e3,cache:!0,success:function(){a=1},error:function(){M.init()}})},isLoaded:function(){return a}}}();return f});