/**
 * desserts
 * @version 2014-12-23 16:37:15
 */
define(["jquery"],function(t){"use strict";function e(){var n=new Date,i=n-g;v>=c&&i>2e3?(u.removeClass("hide"),t(".loading").fadeOut(function(){t(this).remove()}),y.init(),x.init()):setTimeout(function(){e()},200)}function n(){require(["swiper","swiper-smooth-progress"],function(t){d.noSwiping=1,d.noSwipingClass="swipe-stop",m=new t(".page-container",d),m.addCallback("SlideChangeStart",s),m.addCallback("SlideChangeEnd",r),a(),i(),w.init(),w.start(0)})}function i(){t(".s-page-foods").each(function(){var e=t(this).find("article").height(),n=t(window).height();if(e>n){var i=t(this).find(".pic-album"),a=i.height(),o=(n-t(this).find(".title").outerHeight())/a,s=a*(o-1)*o;i.css("transform","scale("+o+", "+o+") translateY("+s+"px)")}var r=t(this),c=r.find(".foods-list").children(),d=c.outerHeight()*c.size()-15,l=0;r.find(".foods-list").on("scroll",function(){var e=t(this),n=e.scrollTop();n>l?n>=d&&e.removeClass("swipe-stop"):0==n&&e.removeClass("swipe-stop"),l=n})})}function a(){t(".tab-nav li").on("touchstart",function(){var e=t(this),n=e.closest(".tab");return e.hasClass("current")||(n.find(".tab-nav>li").removeClass("current"),e.addClass("current"),o(n)),!1}),t(".tab-content-item").on("webkitAnimationEnd",function(){t(this).css({opacity:1})}),o(t(".tab"))}function o(t){var e=t.find(".tab-nav li.current"),n=e.data("target"),i=t.find(".tab-content-item").css({opacity:0}).removeClass(C),a=i.filter('[data-target="'+n+'"]');a.addClass(C)}function s(){}function r(e){var n=t(e.activeSlide());n.find(".foods-list").addClass("swipe-stop"),w.init(),w.start(e.activeIndex)}var c,d,l={},u=t("#g-ctrl"),f=(t("#slide-main"),"slide-wrapper"),h="slide",p={scaleOut:{effects:{onProgressChange:function(t){for(var e=(t.activeIndex,0);e<t.slides.length;e++){var n,i,a,o=t.slides[e],s=o.progress;s>0?(a=1-Math.min(Math.abs(s),1),n=1-Math.min(Math.abs(s/2),1),i=s*t.width):(a=1,n=1,i=0),o.style.opacity=a,t.setTransform(o,"translate3d(0,"+i+"px,0) scale("+n+")")}},onTouchStart:function(t){for(var e=0;e<t.slides.length;e++)t.setTransition(t.slides[e],0)},onSetWrapperTransition:function(t,e){for(var n=0;n<t.slides.length;n++)t.setTransition(t.slides[n],e)}}}},v=0;l.init=function(i){var a=i.effect||"scaleOut";d=t.extend({wrapperClass:f,slideClass:h,slideElement:"section",mode:"vertical",preventLinks:!1},i,p[a].effects),d.updateOnImagesReady=1,d.onImagesReady=function(){e()};var o=[],s={};t(".slide").each(function(){t(this).width(t(window).width()).height(t(window).height());var e=t(this).css("background-image");if("none"!=e&&!s[e]){s[e]=1,e=e.replace(/\'|\"/,"").replace("url(","").replace(")",""),o.push(e);var n=new Image;n.src=e,n.onload=function(){this.complete&&v++}}}),c=o.length,g=new Date,n()};var g,m,w=function(){function e(e){null!=e&&n.eq(e).children().each(function(e){t(this).delay(200*e).fadeIn(400)})}var n=t("article");return{init:function(){n.children().hide()},start:e}}(),b=function(){function e(){n.on("click",function(){n.hasClass("player-btn-stop")?b.on():b.off()})}var n=t(".player-btn"),i=t(".bg-music");return{init:e,off:function(){n.addClass("player-btn-stop"),i[0].pause()},on:function(){n.removeClass("player-btn-stop"),i[0].play()}}}(),C="left-in",y=function(){function e(){return n?!1:(n=1,i.fadeOut(1500,function(){i.remove()}),void b.init())}var n,i=t(".home-mask"),a={},o=5;return{init:function(){var n=t(window).width();i.width(n).height(t(window).height()),i.find("img[data-animation]").each(function(){t(this).addClass(t(this).data("animation"))}),i.on("touchstart","img[data-animation]",function(t){var e=t.originalEvent.changedTouches[0];a.x=e.pageX,a.y=e.pageY});var s=i.find("img");i.on("touchmove","img[data-animation]",function(t){t.preventDefault();var i,r=t.originalEvent.changedTouches[0];if(r.pageX<a.x-o?i="left":r.pageX>a.x+o&&(i="right"),i){var c=r.pageY-a.y;c=5*c,"left"==i&&s.animate({left:-n+"px",top:c+"px"},1500),"right"==i&&s.animate({left:1.5*n+"px",top:c+"px"},1500),setTimeout(function(){e()},500)}}),i.on("touchmove",function(){return!1}),t(document).one("touchstart",function(){b.on()})},start:e}}(),x=function(){function e(){t(".video").each(function(){var e=t(this);e.width(e.outerWidth()).height(e.height())}),t(".video").on("touchstart",function(){k.load(t(this))})}return{init:e}}(),k=function(){function e(e){if(e=t(e),b.off(),e.data("video-loaded")){var a=e.find("video").get(0);a.requestFullscreen?a.requestFullscreen():(i&&a.mozRequestFullScreen(),n&&a.webkitRequestFullscreen()),a.play()}else{var o=e.data("video-src"),s=e.find("img:first").attr("src"),r=t("<video></video>").attr({controls:!0,autoplay:!0,src:o,poster:s,height:"100%"});r.on("play",function(){this.requestFullscreen(),this.webkitRequestFullscreen()}),e.children().hide(),e.append(r),e.data("video-loaded",r)}}var n=/webkit/i.test(navigator.userAgent),i=/firefox\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0;return{load:e}}();return l});